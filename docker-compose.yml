version: '3.8'

services:
  serviceA:
    image: beriloqueiroz/desafio-tracing-distribuido-span-a:latest
    build: 
      context: ./service_A
      dockerfile: "Dockerfile"
    restart: always
    container_name: desafio-tracing-a
    ports:
      - "8080:8080"
    depends_on:
      - otel-collector

  serviceB:
    image: beriloqueiroz/desafio-tracing-distribuido-span-b:latest
    build: 
      context: ./service_B
      dockerfile: "Dockerfile"
    restart: always
    container_name: desafio-tracing-b
    ports:
      - "8081:8081"
    depends_on:
      - otel-collector

  otel-collector:
    image: otel/opentelemetry-collector:latest
    restart: always
    command: "--config=/etc/otel-collector-config.yaml"
    volumes:
      - ./.docker/otel-collector-config.yaml:/etc/otel-collector-config.yaml
    ports: 
      - "8888:8888"
      - "8889:8889"
      - "4317:4317"

